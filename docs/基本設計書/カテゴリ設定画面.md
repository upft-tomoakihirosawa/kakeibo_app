# カテゴリ設定画面 設計書

---

## 1. ドキュメント管理

- 文書名: カテゴリ設定画面 設計書  
- 作成者: 廣澤  
- 作成日: 2025-05-16  

---

## 2. 画面概要

- 画面名称: カテゴリ設定画面  
- 目的・概要: 本画面は、ユーザーが家計簿アプリ内で利用する収支のカテゴリを管理するための画面です。ユーザーは既存のカテゴリの一覧を確認し、新規追加、編集、削除といった操作が可能です。直感的なUI上で、カテゴリの名称変更や整理を行うことで、後続の収支入力時に使いやすいリストを構築できるようにします。

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名       | 属性           | 機能・動作                                                                 | 導出元             | 導出元項目        | 備考                                         |
| ---------------------- | -------------- | -------------------------------------------------------------------------- | ------------------ | ----------------- | -------------------------------------------- |
| カテゴリ一覧リスト     | リスト表示     | ユーザーに現在登録されているカテゴリの一覧を表示。各項目に対して編集・削除操作を付与。               | カテゴリDB（Firestore等） | categories.name   | カテゴリID、作成日等の内部情報は非表示       |
| 新規カテゴリ入力フィールド | テキスト入力   | ユーザーが新規カテゴリ名を入力するためのフィールド。入力後、追加ボタンで登録操作を実行。               | －                 | －                | 入力値は編集前検証対象となる                 |
| カテゴリ追加ボタン     | ボタン         | 入力フィールドに入力された値を元に、新規カテゴリを追加する。クリック時にバリデーション実施後、API呼出し。 | －                 | －                | 成功時はリストに反映。入力欄クリアの処理有      |
| 編集アイコン           | イメージ/ボタン | 各カテゴリ項目に表示。クリック時、該当カテゴリ名を編集モードに切り替え、入力フィールドに変化。    | カテゴリDB         | categories.name   | 編集中は保存ボタンとキャンセルボタンに置換      |
| 保存ボタン             | ボタン         | 編集モード時に、変更内容を保存するためのボタン。クリック時に更新バリデーションを実施、API呼出し。     | －                 | －                | 編集完了後、一覧リストに反映                   |
| キャンセルボタン       | ボタン         | 編集モード時に、変更キャンセルを実施するためのボタン。クリック時、入力内容を破棄し編集モード解除。       | －                 | －                | 編集開始前の状態に戻す                         |
| 削除アイコン           | イメージ/ボタン | 各カテゴリ項目に表示。クリック時、削除確認ダイアログを表示し、ユーザー確認後に削除APIを呼び出す。    | カテゴリDB         | categories.id     | 削除時、カテゴリに紐づく収支との整合性注意       |
| 読込中インジケータ     | プログレスバー | API呼出し時やDB更新処理中に、進捗状況を示すために表示。                          | API/DB             | －                | 非同期処理中に画面全体にオーバーレイ表示可       |

---

## 4. 入力・出力項目

### 入力項目の詳細

本画面表示時に呼び出し元から明示的に渡されるパラメータは特に無し。  
（※ただし、ユーザー認証済み情報に基づき、ログインユーザーのカテゴリ情報は内部APIにより取得する）

### 出力項目の詳細

本画面終了時に呼び出し元へ返すデータは特に無し。  
（※カテゴリ更新後は、カテゴリ一覧リストの最新状態が内部DBに反映され、他画面から参照可能となる）

---

## 5. イベント・アクション仕様

- 画面表示開始時（初期処理）
  - API呼び出しにより、ログインユーザーのカテゴリ一覧をカテゴリDB（Firebase Firestore等）から取得する。
  - 読込中インジケータを表示し、取得完了後にリスト表示に反映する。
- 新規カテゴリ追加アクション
  - ユーザーが新規カテゴリ入力フィールドに名称を入力し、「カテゴリ追加ボタン」をクリック。
  - 入力内容に対して、バリデーション（必須項目、文字数制限）を実施。
  - バリデーションOKの場合、APIを呼び出して新規カテゴリ登録処理を実行。
  - 登録成功時、カテゴリ一覧リストを更新し、入力フィールドをクリアする。
  - エラー時は、エラーメッセージを画面上に表示し、再入力を促す。
- 編集アクション
  - 各カテゴリ項目に表示された「編集アイコン」をクリックすると、該当項目が編集モードとなり、テキスト入力フィールドに切り替わる。
  - 編集モード時は「保存ボタン」と「キャンセルボタン」が表示され、ユーザーは名称の修正が可能。
  - 「保存ボタン」クリック時、バリデーション（必須、1〜20文字）を実施し、問題なければ更新APIを呼出す。
  - 更新成功時、一覧リストに反映し通常表示に戻る。キャンセル時は、変更を破棄し元の表示に戻す。
- 削除アクション
  - 各カテゴリ項目に表示された「削除アイコン」をクリックすると、確認ダイアログを表示。
  - ユーザーが削除を確定した場合、削除APIを呼び出し該当カテゴリを削除する。
  - 削除成功時、一覧リストから項目を除去する。
- 画面終了時（画面遷移前の処理）
  - 画面内で未保存の編集状態があれば、キャンセル処理を実行後、前画面へ戻る。
  - 状態通知として、カテゴリ更新完了のフィードバック（Toast等）を表示する。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

| 項目名         | 制約条件                       | チェック方法                         | 備考                                     |
| -------------- | ------------------------------ | ------------------------------------ | ---------------------------------------- |
| カテゴリ名     | 必須、1〜20文字（全角・半角混在可） | 送信前に入力文字数のチェック、空文字チェック | 既存カテゴリとの重複チェックはAPI側で実施      |

### エラーハンドリング

| エラーコード | エラーメッセージ                                     | 対処方法                                           |
| ------------ | ---------------------------------------------------- | -------------------------------------------------- |
| ERR010       | カテゴリ名を入力してください                          | ユーザーに入力を促し、再度入力を要求する           |
| ERR011       | カテゴリ名は1〜20文字で入力してください               | 入力文字数を見直すようユーザーへメッセージを表示する  |
| ERR012       | 同一名のカテゴリが既に存在します                      | 別の名称を入力するようユーザーに促す                |
| ERR_DB001    | データベース接続エラーが発生しました                    | ネットワーク状況を確認し、再読み込みを促す           |
| ERR_API001   | カテゴリ追加／更新／削除処理中にエラーが発生しました      | エラーメッセージ表示後、該当操作の再実行を試みる      |

---

## 7. 補足情報

- 外部連携・API:
  - カテゴリ情報の取得／登録／編集／削除は、Firebase FirestoreまたはNode.js＋MongoDBを用いたバックエンドAPIをコールする。
  - 各APIのエンドポイント例:
    - GET /api/categories → カテゴリ一覧取得
    - POST /api/categories → 新規カテゴリ追加
    - PUT /api/categories/{id} → カテゴリ更新
    - DELETE /api/categories/{id} → カテゴリ削除
- 参考資料・用語集:
  - 「家計簿アプリ 要件定義書」
  - Firebase Firestoreの基本設計ガイドライン
  - UIコンポーネントの設計基準（ボタン、入力フィールド、リストコンポーネント等）

---

## 8. 課題、検討、不明事項

- 削除時の整合性: 削除対象のカテゴリに紐づく既存の収支データとの連携処理（削除不可、または他カテゴリへの振替処理の検討が必要）。
- 編集時の重複チェック: 既存カテゴリとの名称重複について、クライアント側で事前にチェックするか、API側でのみ検証するかの設計検討。
- リアルタイム同期: 複数端末間でのカテゴリ情報の整合性をどのように扱うか（特にクラウドバックアップと連携する場合の競合状態の対処）。
- UI/UX検討: 編集モードへの遷移や操作ボタンの配置、確認ダイアログの文言など、ユーザーが直感的に操作できる設計の更なるブラッシュアップ。

---

## 9. 変更履歴

| 日付       | 変更内容                           | 担当者 |
| ---------- | ---------------------------------- | ------ |
| 2025-05-16 | 初版リリース                       | 廣澤  |