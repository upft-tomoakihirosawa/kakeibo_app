# ホーム画面 設計書

---

## 1. ドキュメント管理

- **文書名**: ホーム画面 設計書  
- **作成者**: 廣澤  
- **作成日**: 2025-05-16  

---

## 2. 画面概要

- **画面名称**: ホーム画面  
- **目的・概要**:  
  ユーザーが当月の家計状況（収入・支出の合計、カテゴリ別のグラフ表示、年間推移など）を一目で確認できる画面です。  
  利用シナリオとしては、アプリ起動後に自動的に最新の月間収支データを取得し、グラフや数値で視覚的に表示することで、「今月の家計状況」や「予算達成状況」を分かりやすく提示し、他画面（収支入力・履歴確認・設定画面）へのナビゲーションも提供します。

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名                   | 属性                | 機能・動作                                                         | 導出元                  | 導出元項目                         | 備考                                      |
| ---------------------------------- | ------------------- | -------------------------------------------------------------------- | ----------------------- | ----------------------------------- | ----------------------------------------- |
| ヘッダーエリア                     | コンテナ             | 画面上部にユーザー情報（ユーザー名、プロフィール画像）および通知アイコンを表示する | Firebase Auth           | ユーザー名、ユーザーアイコンURL      | タップで「アカウント詳細」または「設定」画面へ遷移可能  |
| 通知アイコン                       | イメージ            | タップ時に通知履歴画面へ遷移                                         | 通知API / Firestore     | 未定義（通知件数アイコンとして表示）  | 未読通知がある場合はバッジで件数表示                   |
| 月間収支サマリーエリア              | コンテナ             | 当月の収入・支出の合計金額、残高・予算達成度を大きく表示する              | Firebase Firestore      | 収入合計、支出合計、予算設定金額         | リアルタイム更新。数値はフォーマット済みデータ           |
| グラフ表示エリア (カテゴリグラフ)     | グラフ描画コンテナ    | 円グラフおよび棒グラフ形式でカテゴリ別収支を表示。ユーザーはグラフ形式の切替が可能   | Firebase Firestore / Chart.js | カテゴリ別金額、支出割合              | グラフ切替はタブまたはスイッチでユーザー操作可能         |
| 月選択ドロップダウン                | スピナー             | 表示対象の月を選択するドロップダウン。選択された月に応じた収支データを再取得         | ローカル（前回選択値の保存）およびFirebase Firestore | 選択した月                      | 初期値は現在月。変更時に画面全体のデータ更新が発動         |
| 収支入力ナビゲーションボタン         | ボタン               | 収支入力画面へ遷移するためのボタン。新規収支の追加操作に誘導                   | －                      | －                                  | 常に画面下部に固定配置                           |
| 詳細履歴ナビゲーションボタン          | ボタン               | 履歴画面へ遷移するためのボタン。過去の収支記録の確認・編集操作に誘導             | －                      | －                                  | 収支入力ボタンと隣接して配置                         |

---

## 4. 入力・出力項目

### 入力項目の詳細

画面表示時に呼び出し元から受け取るデータ項目は以下とする。

| 項目名 | 入力形式 | 入力制約 | エラーメッセージ例 |
| ------ | -------- | -------- | ------------------ |
| 特に無し | －      | －       | －                 |

### 出力項目の詳細

画面終了時に呼び出し元に返すデータ項目は以下とする。

| 項目名 | 内容 |
| ------ | ---- |
| 特に無し | － |

---

## 5. イベント・アクション仕様

- **画面表示開始時（初期処理）**  
  ① Firebase Authからユーザー情報（ユーザー名、プロフィール画像URL）を取得してヘッダーエリアに反映する。  
  ② Firebase Firestoreから当月の収支サマリーデータおよびカテゴリ別の収支データを取得し、月間収支サマリーエリアおよびグラフ表示エリアに描画する。  
  ③ 月選択ドロップダウンの初期値を現在月に設定。  

- **画面上のアクションイベント**  
  ①【通知アイコン】タップ時：通知履歴画面へ遷移。  
  ②【月選択ドロップダウン】変更時：選択された月の収支データをFirebase Firestoreへ問い合わせ、月間サマリーおよびグラフ表示を更新する。  
  ③【収支入力ナビゲーションボタン】タップ時：収支入力画面へ遷移。  
  ④【詳細履歴ナビゲーションボタン】タップ時：履歴表示画面へ遷移。  
  ⑤【グラフ表示エリア】内のタブ/スイッチ操作：円グラフと棒グラフの表示形式を切り替える。  

- **画面終了時（終了処理）**  
  ① 表示状態やユーザーの選択した月などの一部情報をローカルに保持（キャッシュ）し、次回の初期表示速度向上を図る。  
  ② 画面遷移前に必要な状態（例：最新の通知既読状態など）があれば、Firebaseへ更新を行う。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

| 項目名            | 制約条件                              | チェック方法                                | 備考                                   |
| ----------------- | -------------------------------------- | ------------------------------------------- | -------------------------------------- |
| 月選択ドロップダウン | 選択値は「1月～12月」内の有効な月であること | 選択肢リストに含まれるかのチェック            | 初期値は現在月。改ざんチェックの実施             |
| 収支データ         | 取得データは数値フォーマットであること         | APIレスポンスでの型確認および金額書式チェック    | 金額は常にカンマ区切り/通貨フォーマットで表示      |

### エラーハンドリング

| エラーコード | エラーメッセージ                                    | 対処方法                                          |
| ------------ | --------------------------------------------------- | ------------------------------------------------- |
| ERR_HOME_001 | ユーザー情報の取得に失敗しました。                  | ネットワーク状態を確認し再試行。必要に応じてリトライ機能実装 |
| ERR_HOME_002 | 収支データの取得に失敗しました。                     | ログ出力の上、ユーザーへエラーダイアログ表示。後続処理中断   |
| ERR_HOME_003 | 選択された月のデータが不正です。                    | 月選択ドロップダウンの内容を再確認。初期値にリセット         |
| ERR_HOME_004 | グラフ描画に失敗しました。                           | Chart.jsのエラー内容をログ出力し、再描画処理を試行             |

---

## 7. 補足情報

- **外部連携・API**:  
  ① Firebase Auth API: ユーザー認証およびユーザー情報取得  
  ② Firebase Firestore: 収支記録・収支サマリーデータ、およびカテゴリ別収支データの取得  
  ③ Chart.js: グラフ描画（円グラフ、棒グラフ）  
  ④ 通知API（またはFirebase Cloud Messaging）: 通知データの取得および既読更新

- **参考資料・用語集**:  
  ① 「家計簿アプリ 要件定義書」  
  ② Chart.jsドキュメント  
  ③ Firebase公式ドキュメント  
  ※ 用語例: 「収支サマリー」＝収入・支出の合計表示、「カテゴリ別グラフ」＝各カテゴリに属する収支内訳グラフ

---

## 8. 課題、検討、不明事項

- 収支データのリアルタイム更新処理（Firestoreのリアルタイムリスナーの利用）の最適化検討。  
- オフライン時のデータキャッシュおよび再同期時の整合性維持の検討。  
- ユーザーによるグラフ切替の操作性向上（タッチ操作レスポンスやアニメーション）の最適化。  
- 多言語対応の場合のテキスト表示やフォントサイズ調整検討。  
- 通知アイコンの既読/未読状態の変更タイミングに関する仕様調整。

---

## 9. 変更履歴

| 日付       | 変更内容                           | 担当者 |
| ---------- | ---------------------------------- | ------ |
| 2025-05-16 | 初版リリース                       | 廣澤  |