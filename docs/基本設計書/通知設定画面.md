# 通知設定画面 設計書

---

## 1. ドキュメント管理

- **文書名**: 通知設定画面 設計書  
- **作成者**: 廣澤  
- **作成日**: 2025-05-16  

---

## 2. 画面概要

- **画面名称**: 通知設定画面  
- **目的・概要**: ユーザーが家計簿アプリ内で受信する各種通知（例：収支入力忘れ通知、予算超過時アラート）のON/OFF設定を行うための画面。ユーザーは各通知項目の有効／無効を切り替え、設定の保存を行うことで、自身の利用シーンに合わせた通知のカスタマイズを実現できる。  

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名           | 属性         | 機能・動作                                                                                 | 導出元             | 導出元項目                   | 備考                                     |
| -------------------------- | ------------ | ------------------------------------------------------------------------------------------ | ------------------ | ---------------------------- | ---------------------------------------- |
| 通知設定エリア             | コンテナ     | 本画面の全体レイアウトを格納する領域                                                       | －                 | －                           | 全体の背景、マージン等を定義              |
| 入力忘れ通知スイッチ       | トグルスイッチ | ユーザーが「収支入力忘れ通知」のON/OFFを切り替える                                          | ユーザー設定API   | reminderNotification         | 初期値はDBより取得、切り替え動作で即時反映  |
| 入力忘れ通知ラベル         | テキスト表示 | 「収支入力忘れ通知」の説明テキスト（例：入力忘れ防止のためのリマインド通知）                | 定固定テキスト     | －                           |                                              |
| 予算超過通知スイッチ       | トグルスイッチ | ユーザーが「予算超過通知」のON/OFFを切り替える                                              | ユーザー設定API   | budgetAlertNotification      | 初期値はDBより取得、切り替え動作で即時反映  |
| 予算超過通知ラベル         | テキスト表示 | 「予算超過通知」の説明テキスト（例：設定予算超過時に警告を行う通知）                        | 定固定テキスト     | －                           |                                              |
| 保存ボタン                 | ボタン       | ユーザーの通知設定変更内容を確定し、更新APIへ送信。成功時は確認メッセージを表示後、前画面へ戻る  | －                 | －                           | 入力項目の変更があった場合のみ有効化         |
| 戻るボタン                 | ボタン       | 画面を終了し、呼び出し元画面に遷移。設定変更が保存されていない場合は警告ダイアログを表示       | －                 | －                           | キャンセル確認のダイアログ表示あり         |
| 読込中表示                 | プログレスバー | APIからのデータ取得中、更新中に表示                                                     | ユーザー設定API   | －                           | データ取得または更新処理中に表示           |

---

## 4. 入力・出力項目

### 入力項目の詳細

本画面表示時に呼び出し元または内部APIから受け取るデータ項目は以下のとおりである。

| 項目名                   | 入力形式  | 入力制約          | エラーメッセージ例                              |
| ------------------------ | --------- | ----------------- | ----------------------------------------------- |
| reminderNotification     | Boolean   | true / falseのみ | 特に無し                                      |
| budgetAlertNotification  | Boolean   | true / falseのみ | 特に無し                                      |

※ その他の詳細な入力パラメータ（例：ユーザーID等）は、内部的に認証済みの状態でAPIから取得するため、明示的な入力項目としては扱わない。

### 出力項目の詳細

画面終了時に呼び出し元へ返すデータ項目は以下のとおりである。

| 項目名       | 内容                                         |
| ------------ | -------------------------------------------- |
| 更新結果     | 「成功」または「失敗」の処理結果メッセージ    |

※ 画面終了時に明示的な出力項目が不要な場合は、「特に無し」とするが、今回は設定変更結果を連携するため、上記の項目を定義する。

---

## 5. イベント・アクション仕様

- 画面表示開始時の初期処理  
  • 画面ロード時にユーザー認証済みの状態を確認後、ユーザー設定APIを呼び出し、現在の通知設定（reminderNotification、budgetAlertNotification）を取得する。  
  • 読込中表示（プログレスバー）を表示し、取得完了後に各スイッチの初期状態を反映する。  

- 画面上でのアクションイベント  
  • 入力忘れ通知スイッチおよび予算超過通知スイッチのトグル操作：オン／オフの状態を内部状態としてリアルタイムに更新する。  
  • 保存ボタンのクリック：  
  – 入力された各通知設定値を検証後、ユーザー設定APIへ更新リクエスト（PUT/POST）を実行する。  
  – 更新成功時は「設定更新完了」の確認メッセージを表示し、呼び出し元に更新結果として返す。  
  – 更新失敗時はエラーダイアログを表示し、再試行を促す。  
  • 戻るボタンのクリック：  
  – 保存していない変更がある場合、確認ダイアログ（「変更内容が保存されていません。破棄して戻りますか？」）を表示する。  
  – ユーザーが確認した場合、変更内容を破棄して前画面に戻る。  

- 画面終了時の終了処理  
  • 画面終了前に、必要に応じて内部状態の保存状況をチェックし、未保存変更がある場合は確認処理を実行する。  
  • 正常な終了の場合、更新結果（成功／失敗）を呼び出し元へ返す。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

| 項目名                  | 制約条件                      | チェック方法                      | 備考                           |
| ----------------------- | ----------------------------- | --------------------------------- | ------------------------------ |
| reminderNotification    | Boolean型であること           | トグル操作時に内部状態チェック      | true / falseの値のみ有効         |
| budgetAlertNotification | Boolean型であること           | トグル操作時に内部状態チェック      | true / falseの値のみ有効         |

※ 本画面はトグルスイッチのみの入力であり、文字列入力等の形式チェックは不要。

### エラーハンドリング

| エラーコード | エラーメッセージ                                         | 対処方法                                |
| ------------ | -------------------------------------------------------- | --------------------------------------- |
| ERR_API_GET  | 通知設定の取得に失敗しました。インターネット接続を確認してください。 | エラーダイアログを表示し、再取得を促す    |
| ERR_API_UPD  | 通知設定の更新に失敗しました。再度お試しください。       | エラーダイアログを表示し、保存操作の再試行 |
| ERR_NET      | ネットワークエラーが発生しました。                     | ネットワーク状態の確認と再試行           |

---

## 7. 補足情報

- **外部連携・API**:  
  • ユーザー設定API  
  – エンドポイント例: GET /api/user/settings 及び PUT /api/user/settings  
  – サンプルリクエスト：{ "reminderNotification": true, "budgetAlertNotification": false }  
  – サンプルレスポンス：{ "status": "success", "data": { "reminderNotification": true, "budgetAlertNotification": false } }  

- **参考資料・用語集**:  
  • 家計簿アプリ 要件定義書（通知・リマインダー項目参照）  
  • UIガイドライン「シンプルかつ直感的なUI設計」

---

## 8. 課題、検討、不明事項

- モバイル（iOS、Android）とWebでのプッシュ通知実装におけるUI/UXの差異の検討が必要。  
- ユーザー設定APIのレスポンス速度が通知設定画面のユーザビリティに影響するため、キャッシュの導入やエラーハンドリングのさらなる検討が必要。  
- 戻るボタンによるキャンセル時の未保存変更の扱い（自動保存の検討含む）の仕様が未確定。  
- 通知設定の詳細オプション（たとえば、通知音やバイブレーション設定など）の拡張が将来的な仕様として検討される可能性あり。

---

## 9. 変更履歴

| 日付       | 変更内容                   | 担当者 |
| ---------- | -------------------------- | ------ |
| 2025-05-16 | 初版リリース               | 廣澤  |