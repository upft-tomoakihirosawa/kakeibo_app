# 入力画面 設計書

---

## 1. ドキュメント管理

- 文書名: 入力画面 設計書  
- 作成者: 廣澤  
- 作成日: 2025-05-16  

---

## 2. 画面概要

- 画面名称: 収支入力画面
- 目的・概要:  
  ユーザーが日々の収入・支出を記録するための画面です。ユーザーは金額、カテゴリ、日付、メモを入力し、必要に応じて定期収支としてマークできます。画面はシンプルかつ直感的なUIで構成され、入力時のバリデーションやエラー処理を通じて正確なデータ登録を支援します。画面表示時には、現在の日付を自動設定し、ユーザー定義のカテゴリ一覧（設定画面で登録・編集したもの）をプルダウン（スピナー）で表示します。

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名         | 属性              | 機能・動作                                                         | 導出元               | 導出元項目                | 備考                                           |
| ------------------------ | ----------------- | ------------------------------------------------------------------ | -------------------- | ------------------------- | ---------------------------------------------- |
| 戻るボタン               | ボタン            | タップで前画面（ホーム画面）に戻る                                   | 特に無し            | 特に無し                  | ヘッダー部に常時表示                           |
| 金額入力フィールド       | テキスト入力      | ユーザーが収入または支出の金額を数値で入力する                        | 特に無し            | 特に無し                  | 数値入力専用キーボード、必須項目                |
| カテゴリ選択スピナー     | スピナー          | ユーザーがカテゴリ一覧から該当するカテゴリを選択する                  | カテゴリ取得API      | カテゴリ名、カテゴリID     | 設定画面でカスタマイズしたカテゴリを反映         |
| 日付入力フィールド       | 日付ピッカー      | カレンダー表示により日付を選択。初期値はシステム日付（当日）を設定   | システム日付         | 現在日付                  | 入力必須、カレンダーUIで選択                     |
| メモ入力エリア           | テキストエリア    | 入力内容の補足情報、自由記述欄。任意入力                            | 特に無し            | 特に無し                  | 最大文字数の制限（例：200文字）を設ける検討有       |
| 定期収支トグル           | トグルスイッチ    | 入力内容を定期的な収支としてマーク。ONの場合は定期入力扱いとなる       | 特に無し            | 特に無し                  | オプション項目、ON時は定期更新処理に連携の検討有   |
| 記録する送信ボタン       | ボタン            | タップで入力内容のバリデーションを実施後、収支登録APIを呼び出して保存   | 収支登録API          | 登録結果、ステータス      | バリデーションエラー時はエラーメッセージを表示      |

---

## 4. 入力・出力項目

### 入力項目の詳細

本画面表示時に呼び出し元から渡されるデータは特に無し。

→ 特に無し

### 出力項目の詳細

本画面終了時（登録完了後またはキャンセル時）に呼び出し元へ返すデータは以下の通り。

| 項目名      | 内容                                                         |
| ----------- | ------------------------------------------------------------ |
| 登録結果    | 収支登録時の成功または失敗のステータス、及び登録済み取引の詳細情報 |
| フィードバックメッセージ | ユーザーへの操作結果（例：「登録が完了しました」またはエラー詳細） |

---

## 5. イベント・アクション仕様

- 画面表示開始時の初期処理:  
  ・ システム日付を取得し、日付入力フィールドに初期値として設定する。  
  ・ カテゴリ取得APIを呼び出し、ユーザーが定義したカテゴリ一覧を取得し、カテゴリ選択スピナーに展開する。
  
- 入力フィールドのイベント:  
  ・ 金額入力フィールド: 入力中は数字のみ許容し、リアルタイムで数値フォーマットをチェックする。  
  ・ カテゴリ選択スピナー: タップ時にカテゴリリストをドロップダウン表示し、選択された項目を表示する。  
  ・ 日付入力フィールド: タップ時にカレンダーUIを展開し、日付選択後はその値をフィールドに反映する。  
  ・ メモ入力エリア: 入力完了後の文字数チェックを実施（最大文字数制限）。  
  ・ 定期収支トグル: ON/OFFの切替動作で、必要に応じた定期登録ロジック（バックエンド/APIへのフラグ送信）を連動する。

- 送信ボタンのタップイベント:  
  ・ 入力値の各バリデーション（必須項目チェック、金額の数値チェック、日付の妥当性チェック）を実施する。  
  ・ バリデーション成功時、収支登録APIに入力データ（金額、カテゴリID、日付、メモ、定期フラグ）を送信する。  
  ・ APIから成功レスポンスを取得した場合、画面終了処理として、呼び出し元へ「登録結果」と「フィードバックメッセージ」を返し、ホーム画面へ遷移する。  
  ・ バリデーションまたはAPIエラー発生時、該当エラー内容をユーザーにポップアップまたは画面上に表示し、再入力を促す。

- 画面終了時の終了処理:  
  ・ ユーザーが登録完了またはキャンセルボタンを押した場合、現在の入力内容は破棄し、呼び出し元へ終了状態と（必要であれば最新の登録結果）を返す。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

| 項目名         | 制約条件                                    | チェック方法                         | 備考                                 |
| -------------- | ------------------------------------------- | ------------------------------------ | ------------------------------------ |
| 金額入力フィールド | 必須、数値のみ、0より大きい値               | 数値変換及び0超チェック（リアルタイム）  | 例：500, 1000等（カンマや小数点の扱いを検討） |
| カテゴリ選択スピナー | 必須、リスト内の有効なカテゴリが選択されていること | 選択状態の存在を確認                  | カテゴリ未選択の場合はエラーメッセージ表示          |
| 日付入力フィールド  | 必須、有効な日付フォーマット（YYYY-MM-DD）   | 日付パーサーによるフォーマット検証       | システム日付との整合性も検討が必要               |
| メモ入力エリア      | 任意（最大200文字程度）                        | 文字数カウントによる制限チェック           | 入力文字数が上限を超えた場合は入力不可            |

### エラーハンドリング

| エラーコード | エラーメッセージ                                           | 対処方法                                           |
| ------------ | ---------------------------------------------------------- | -------------------------------------------------- |
| ERR101       | 金額が未入力または無効です。正しい数値を入力してください。    | 対象フィールドにエラーメッセージを表示し、再入力を促す |
| ERR102       | カテゴリが選択されていません。カテゴリを選択してください。       | カテゴリ選択スピナーにフォーカスを誘導する             |
| ERR103       | 日付が未入力または無効です。正しい日付を選択してください。        | 日付ピッカーを再起動し、正しい日付設定を促す           |
| ERR104       | 内部エラーが発生しました。管理者へお問い合わせください。         | エラー内容をログ出力し、利用者には汎用エラーメッセージを表示 |

API呼び出し時やDB更新時のエラー（タイムアウト、ネットワークエラー、DBアクセス失敗等）についても、ERR104のエラーハンドリングと統一する運用とする。

---

## 7. 補足情報

- 外部連携・API:  
  ・ カテゴリ取得API: GET /categories  
    → ユーザーが設定したカテゴリ一覧（カテゴリ名、IDなど）を取得  
  ・ 収支登録API: POST /transactions  
    → 入力画面から送信された金額、カテゴリID、日付、メモ、定期フラグを元に取引データを登録  
  ・ 利用DB: Firebase Firestore または Node.js + MongoDB によるデータ保存処理

- 参考資料・用語集:  
  ・ 「家計簿アプリ 要件定義書」  
  ・ UI設計ガイドライン（直感的操作とシンプルデザインの実現方法）  
  ・ カテゴリ管理および定期収支登録に関する既存システムのベストプラクティス

---

## 8. 課題、検討、不明事項

- ユーザーが登録中にアプリを強制終了した場合のデータ整合性の保証方法（自動保存の有無）の検討が必要。  
- 定期収支トグルON時の詳細設定（繰返し周期、終了日等）のUI導入の必要性については、今後の拡張で検討する。  
- APIおよびDBのレスポンス遅延時に、プログレスバー等のロード表示を行うか否か、ユーザー体験改善のための検討が必要。  
- エラーハンドリングに関する詳細なエラーコードの追加や、各種ネットワークエラー・タイムアウトに対する対処方法の詳細仕様が未確定なため、実装フェーズで再検討する。

---

## 9. 変更履歴

| 日付       | 変更内容               | 担当者 |
| ---------- | ---------------------- | ------ |
| 2025-05-16 | 初版リリース           | 廣澤 |

