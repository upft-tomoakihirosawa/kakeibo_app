# グラフ表示画面 設計書

---

## 1. ドキュメント管理

- 文書名: グラフ表示画面 設計書  
- 作成者: 廣澤  
- 作成日: 2025-05-16  

---

## 2. 画面概要

- 画面名称: グラフ表示画面  
- 目的・概要:  
  この画面は、ユーザーが家計簿アプリ内で月ごとの収支サマリー、カテゴリ別の支出割合、月別の収支詳細、年間推移、及び予算達成度を視覚的に確認できるよう、各種グラフ（円グラフ、棒グラフ、ラインチャート、プログレスバー等）を用いてデータを表示する。ユーザーは、直感的なUIによって自身の収支状況や予算管理の状況を一目で把握でき、必要に応じた改善策を検討するための情報として活用する。

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名             | 属性           | 機能・動作                                                                 | 導出元                         | 導出元項目                  | 備考                                           |
| ---------------------------- | -------------- | -------------------------------------------------------------------------- | ------------------------------ | --------------------------- | ---------------------------------------------- |
| 収支サマリーグラフ           | グラフコンポーネント（Chartエリア） | 月間の総収入・支出の集計および内訳をグラフ表示し、タップ時に詳細情報ポップアップを表示する。 | 収支データAPI / Firestore     | monthlySummaryData          | 初期表示時に非同期でデータ取得                |
| カテゴリ別円グラフ           | グラフコンポーネント（円グラフ）      | 各カテゴリごとの支出割合を円グラフにより表示。各セグメントはクリックで該当カテゴリの詳細画面へ遷移可能。  | 収支データAPI / Firestore     | categoryData                | 円グラフライブラリ（Chart.js or Recharts）利用 |
| 月別棒グラフ                | グラフコンポーネント（棒グラフ）      | 月ごとの収入と支出の内訳を棒グラフで表示。棒をタップするとその月の詳細データを表示。  | 収支データAPI / Firestore     | monthlyData                 | クリック時のアニメーションを実施               |
| 年間推移グラフ               | グラフコンポーネント（ラインチャート）| 年間の収支のトレンドをラインチャート形式で表示し、全期間の推移を一目で確認可能。             | 年間統計API / Firestore       | annualTrendData             | スクロールやスワイプで詳細データの確認が可能    |
| 予算達成度表示コンポーネント | プログレスバー   | ユーザーが設定した各月の予算に対する実績の進捗状況をパーセンテージ、及び視覚的なプログレスバーで表示。  | 予算管理API / Firestore       | budgetProgress              | 予算超過時に色変更（例：緑→赤）                |
| グラフタイトルラベル         | テキスト表示      | 各グラフにタイトルを表示し、内容を明示する。                                | 定数（画面固定値）              | title                       | 例：「月間収支サマリー」、「カテゴリ分析」      |
| 更新ボタン                    | ボタン           | ユーザーが最新の収支、統計データを手動で再取得するためのボタン。クリック時に全グラフのデータ更新を実施。   | 特に無し                      | 特に無し                  | ローディングアニメーションと連動              |

---

## 4. 入力・出力項目

### 入力項目の詳細

本画面表示時に呼び出し元から明示的に渡されるデータ項目は特に無し。  
※ただし、ユーザー認証済みのセッション情報や、画面遷移時に選択された期間情報（オプション）は内部的に保持する場合がある。

### 出力項目の詳細

本画面終了時に呼び出し元へ返すデータ項目は特に無し。  
※画面内での操作（グラフのタップや詳細表示への遷移）はそれぞれの画面遷移やポップアップ内で処理する。

---

## 5. イベント・アクション仕様

- 画面表示開始時の初期処理  
  • 画面起動時、各グラフコンポーネントに対して非同期API呼び出しを実施し、最新の収支データ、カテゴリ別、月別、年間推移、及び予算達成データを取得する。  
  • ローディングアニメーション（プログレスバー）を表示。  
  • 各グラフ取得後、アニメーションを伴ってグラフを描画。

- コンポーネントのイベント  
  • 各グラフ要素のタップイベント：タップ時に、該当グラフの詳細情報ポップアップまたは別画面へ遷移する。  
  • 更新ボタンのクリックイベント：全グラフのデータを再取得し、最新データにアップデートする。  
  • グラフのスワイプ・ドラッグイベント（年間推移グラフ）：詳細な期間を表示するためのスクロール処理を実施。

- 画面終了時の処理  
  • 特に入力データの返却等は行わず、ユーザーが遷移する際はセッション管理情報を保持した状態で前画面又は次画面へ遷移。

- 状態通知時の処理  
  • APIエラーやタイムアウト発生時は、エラーダイアログを表示し、ユーザーに「再試行」オプションを提供する。  
  • 予算超過が確認された場合、予算達成度表示コンポーネントの色変更とポップアップ通知を実施。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

※本画面は主に表示用で入力項目は存在しないため、各APIから取得するデータの整合性のチェックを実施する。

| 項目名         | 制約条件                                    | チェック方法                          | 備考                                    |
| -------------- | ------------------------------------------- | ------------------------------------- | --------------------------------------- |
| APIレスポンス | JSON形式、必須フィールド（例：データ配列等）が存在すること | APIレスポンス受信時に構造チェック＋nullチェック | 必ず各グラフのデータ構造が正しいか確認      |

### エラーハンドリング

| エラーコード   | エラーメッセージ                                  | 対処方法                                   |
| -------------- | ------------------------------------------------- | ------------------------------------------ |
| ERR_GRAPH_001  | 収支サマリーグラフのデータ取得に失敗しました         | ユーザーに「再試行」ボタンの案内、ログ記録  |
| ERR_GRAPH_002  | カテゴリ別グラフのデータ取得に失敗しました           | ページ下部にエラー通知を表示、更新ボタンで再取得 |
| ERR_GRAPH_003  | 月別棒グラフのデータに不整合が検出されました         | エラーダイアログを表示、管理者通知を検討      |
| ERR_GRAPH_004  | 年間推移グラフのデータ取得に失敗しました             | 再試行処理を促し、再取得を試みる             |
| ERR_GRAPH_005  | 予算達成度データが不正です                         | デフォルト値（0%）を表示し、エラーをログに記録   |

※各API呼び出し後、タイムアウトまたはHTTPエラーが発生した場合は、共通のエラーハンドリング処理（例：エラーダイアログ表示＋「再試行」ボタン提供）を適用する。

---

## 7. 補足情報

- 外部連携・API  
  • 収支データAPI：収入・支出の詳細データを取得（エンドポイント例：/api/finance/monthly-summary、/api/finance/category、/api/finance/monthly、/api/finance/annual）  
  • 予算管理API：予算設定と実績データを取得（エンドポイント例：/api/finance/budget）  
  • 各APIはFirebase FirestoreやNode.js＋MongoDBにより管理  
- グラフ描画ライブラリとしてChart.jsまたはRechartsを検討  
- 参考資料・用語集  
  • 家計簿アプリ要件定義書  
  • Chart.js / Recharts公式ドキュメント  
  • UIデザインガイドライン

---

## 8. 課題、検討、不明事項

- グラフ更新時のパフォーマンス最適化方法（特に大量データ時の表示速度）  
- レスポンシブデザインにおける各グラフのサイズ自動調整の実装方法  
- 各APIからのデータ取得タイミングとキャッシュ戦略の検討  
- エラーハンドリング時のユーザーへの通知方法（ダイアログ、トーストメッセージ等）の一貫性の確保  
- タッチ操作時のインタラクション（タップ、スワイプ）のユーザビリティ検証

---

## 9. 変更履歴

| 日付       | 変更内容                       | 担当者  |
| ---------- | ------------------------------ | ------- |
| 2025-05-16 | 初版リリース                   | 廣澤   |