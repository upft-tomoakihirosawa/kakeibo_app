# 履歴画面 設計書

---

## 1. ドキュメント管理

- 文書名: 履歴画面 設計書  
- 作成者: 廣澤  
- 作成日: 2025-05-16  

---

## 2. 画面概要

- 画面名称: 履歴画面  
- 目的・概要:  
  ユーザーがこれまでに記録した各収支（収入および支出）の一覧を時系列で表示する画面です。各取引アイテムには詳細（取引日、カテゴリ、金額、メモ）が表示され、各項目ごとに編集および削除のアクションが可能です。また、画面初期表示時にはDBから最新の取引データを取得し、ロード中はプログレスバーで状態を示します。

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名   | 属性        | 機能・動作                                                                                                  | 導出元                | 導出元項目                                   | 備考                                           |
| ------------------ | ----------- | ----------------------------------------------------------------------------------------------------------- | --------------------- | -------------------------------------------- | ---------------------------------------------- |
| 履歴リスト         | リスト表示  | ユーザーの収支記録を時系列で一覧表示。各アイテム内に取引日、カテゴリ、金額、メモを表示し、編集・削除ボタン付き。 | Firebase Firestore、またはDB（家計簿DB） | 取引ID、日付、カテゴリ、金額、メモ             | 画面初期表示時にAPI経由でデータを取得             |
| 取引日付ラベル     | テキスト表示| 各取引アイテム内に表示する日付。                                                                         | Firebase Firestore   | 日付                                         | 各レコード毎に表示                             |
| カテゴリラベル     | テキスト表示| 各取引アイテムのカテゴリ名を表示。                                                                         | Firebase Firestore   | カテゴリ                                     |                                                 |
| 金額ラベル         | テキスト表示| 各取引アイテムの金額を表示。                                                                               | Firebase Firestore   | 金額                                         |                                                 |
| メモラベル         | テキスト表示| ユーザーが入力したメモを表示。                                                                             | Firebase Firestore   | メモ                                         | 文字数により省略表示の場合あり                   |
| 編集ボタン         | ボタン      | 各取引アイテムごとにクリックすると、該当取引の編集画面へ遷移。                                             | －                    | －                                           | 編集画面に対象レコードのIDをパラメータとして渡す |
| 削除ボタン         | ボタン      | 各取引アイテムごとにクリックすると、削除確認ダイアログを表示。確認後、取引を削除するAPIを呼び出す。         | －                    | －                                           | 削除成功時はリストを再取得                       |
| 読込中インジケーター | プログレスバー | 画面表示時やデータ取得中に、処理中であることを視覚的に示す。                                                   | －                    | －                                           | API取得中のみ表示                               |

---

## 4. 入力・出力項目

### 入力項目の詳細

呼び出し元から本画面にアクセスする際、特にパラメータ等は渡されない。  
→ 特に無し

### 出力項目の詳細

本画面終了時に呼び出し元へ返すデータは特に設定していない。  
→ 特に無し

---

## 5. イベント・アクション仕様

- 画面表示開始時:
  - 初期処理として、読込中インジケーターを表示。
  - Firebase Firestore（または指定DB）の取引履歴データを取得するAPIを呼び出す。
  - 取得完了後、履歴リストコンポーネントにデータをバインドし、読込中インジケーターを非表示にする。
  - APIエラーが発生した場合は、エラーメッセージを表示し、再試行オプションを提供する。

- 履歴リスト内の各取引アイテム:
  - 編集ボタンクリック:
    - 該当取引レコードのIDをパラメータとして編集画面へ遷移する。
  - 削除ボタンクリック:
    - 削除確認ダイアログを表示し、ユーザー確認後に削除APIを呼び出す。
    - 削除成功後は、最新データ取得のためにリストの再読み込みを実行する。
    - 削除失敗の場合は、適切なエラーメッセージを表示する。

- 画面終了時:
  - 画面の状態（例えばフィルタ設定や選択中データなど）があれば、初期化する。
  - 必要に応じて、画面終了時のトランジションやリソース解放処理を実行する。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

本画面は主に一覧表示のため、ユーザー入力フィールドは存在しない。  
→ 特に無し

### エラーハンドリング

| エラーコード | エラーメッセージ                                  | 対処方法                                 |
| ------------ | ----------------------------------------------- | ---------------------------------------- |
| ERR101       | 取引履歴データの取得に失敗しました。             | ユーザーに再試行を促し、一定時間後に自動再取得。 |
| ERR102       | 該当取引の削除に失敗しました。                   | 削除操作の再実行、もしくはサポート窓口への問い合わせを促す。 |
| ERR103       | ネットワークエラーが発生しました。               | ネットワーク接続の確認および再試行ボタンの提供。 |

---

## 7. 補足情報

- 外部連携・API:  
  - Firebase Firestore APIを利用して、ユーザーの取引履歴の取得、更新、削除を行う。  
  - 削除操作は認証済みユーザーIDに紐づいたデータのみを対象。
  
- 参考資料・用語集:  
  - 「家計簿アプリ 要件定義書（2025/05作成）」  
  - 用語: 取引ID、クラウドバックアップ、定期収支　など

---

## 8. 課題、検討、不明事項

- 大量の取引履歴データを取得した場合のパフォーマンス改善（ページングや無限スクロールの導入検討）。
- 削除操作に対する誤操作防止のための確認ダイアログのUI/UX検討（例えば、Undo機能の実装検討）。
- 取引履歴のフィルタリングや検索機能の拡張の要否について未検討。
- ネットワーク環境が不安定な場合のリトライ戦略や、取得失敗時のユーザー通知方法の詳細検討。

---

## 9. 変更履歴

| 日付       | 変更内容                  | 担当者 |
| ---------- | ------------------------- | ------ |
| 2025-05-16 | 初版リリース              | 廣澤  |