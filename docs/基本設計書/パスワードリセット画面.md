# パスワードリセット画面 設計書

---

## 1. ドキュメント管理

- **文書名**: パスワードリセット画面 設計書  
- **作成者**: 廣澤  
- **作成日**: 2025-05-16  

---

## 2. 画面概要

- **画面名称**: パスワードリセット画面  
- **目的・概要**:  
  ユーザーがパスワードを忘れた場合に、登録済みのメールアドレスを入力し、パスワードリセット用のリンクを送信するための画面です。  
  ユーザーはメールアドレスを入力後、送信ボタンを押すことで、バックエンドのパスワードリセットAPIが起動し、登録メールアドレス宛にリセットリンクが送信されます。送信完了後は、成功メッセージが表示され、ログイン画面へ戻る操作を促します。

---

## 3. UIコンポーネント詳細

### コンポーネント一覧

| コンポーネント名               | 属性         | 機能・動作                                                        | 導出元                  | 導出元項目                | 備考                                  |
| ------------------------------ | ------------ | ------------------------------------------------------------------- | ----------------------- | ------------------------- | ------------------------------------- |
| メールアドレス入力フィールド   | テキスト入力 | ユーザーがパスワードリセット用の登録メールアドレスを入力する         | 画面初期表示時は空欄      | －                        | プレースホルダー：「メールアドレスを入力」 |
| リセット送信ボタン             | ボタン       | クリック時に入力されたメールアドレスのバリデーションを行い、API呼出しを実行する | パスワードリセットAPI    | （リクエストパラメータ：email） | クリック後、送信中は非活性化          |
| エラーメッセージ表示エリア     | テキスト表示 | バリデーションエラーやAPIエラー発生時にエラーメッセージを表示          | APIレスポンス           | （response.errorMessage） | 初期状態は非表示、エラー発生時に表示    |
| 戻るリンク（または戻るボタン） | ボタン/リンク| クリック時にログイン画面へ遷移する                                    | 画面遷移処理             | －                        | ユーザー操作による任意の戻り操作         |
| 読込中インジケーター           | プログレスバー | API呼び出し中に画面上に処理中を示すインジケーター                     | API呼び出し中の状態       | －                        | API通信開始時に表示、完了後非表示         |

---

## 4. 入力・出力項目

### 入力項目の詳細

画面表示時に呼び出し元から受け取るデータ項目は以下とする。

  特に無し

### 出力項目の詳細

画面終了時（リセット送信完了後または戻る操作時）に呼び出し元へ返すデータ項目は以下とする。

  特に無し

---

## 5. イベント・アクション仕様

- **画面表示時の初期処理**  
  1. メールアドレス入力フィールドを空欄に初期化する。  
  2. エラーメッセージ表示エリアを非表示にする。  
  3. 読込中インジケーターは非表示状態に設定する。

- **メールアドレス入力フィールド関連イベント**  
  - 入力完了（フォーカスアウト時）：入力内容のフォーマット（メールアドレス形式）の簡易バリデーションを実施。  
  - 入力中は特に動的な処理は行わないが、入力エラーがあった場合はエラーメッセージ表示エリアにアラートを表示する。

- **リセット送信ボタンクリック時の処理**  
  1. 入力されたメールアドレスに対し、以下のバリデーションを実施する。  
     ・必須入力チェック  
     ・メールアドレス形式のチェック（例：正規表現による検証）  
  2. バリデーションエラーが発生した場合、エラーメッセージ表示エリアにエラー内容を表示し、処理を中断する。  
  3. バリデーションを通過した場合、読込中インジケーターを表示し、リセット送信ボタンを非活性化する。  
  4. バックエンドのパスワードリセットAPI（例：POST /api/password-reset）を呼び出す。送信パラメータとしてメールアドレスを渡す。  
  5. APIレスポンスを受け取り、正常（成功）であれば、成功メッセージ（例：「パスワードリセット用リンクを登録メールアドレスに送信しました」）を表示する。  
  6. APIエラーの場合には、エラーメッセージ表示エリアにエラー内容を表示する。  
  7. 読込中インジケーターを非表示にし、リセット送信ボタンを再活性化する。

- **戻るリンククリック時の処理**  
  ・ ログイン画面へ遷移する。  

- **画面終了時の終了処理**  
  ・ ユーザーがリセット処理完了もしくは戻る操作を行った場合、画面内の一時状態（入力値、エラーメッセージ、API呼び出し状態）をクリアする。

---

## 6. バリデーションとエラーハンドリング

### バリデーションルール

| 項目名           | 制約条件                                     | チェック方法                         | 備考                                   |
| ---------------- | -------------------------------------------- | ------------------------------------ | -------------------------------------- |
| メールアドレス   | 必須、正しいメールアドレス形式（例：xxx@yyy.zz） | 送信ボタン押下時に正規表現によるチェック | 例：ユーザー登録時のメールアドレス形式と同一 |

### エラーハンドリング

| エラーコード | エラーメッセージ                                             | 対処方法                                   |
| ------------ | ------------------------------------------------------------ | ------------------------------------------ |
| ERR101       | メールアドレスを正しく入力してください。                     | 入力内容を確認し、正しいメールアドレスを再入力すること。   |
| ERR102       | 入力されたメールアドレスは登録されていないか、リセット処理に失敗しました。 | ユーザー登録状態を確認し、必要に応じてサポートへ問い合わせること。 |
| ERR103       | サーバーとの通信エラーが発生しました。                        | ネットワーク環境を確認し、再度送信ボタンを押してください。     |

※ API呼び出し時のエラー（内部サーバーエラー、DB接続エラー等）はERR102または共通エラーにて対応する。

---

## 7. 補足情報

- **外部連携・API**:  
  ・ パスワードリセットAPI  
    － エンドポイント例：POST /api/password-reset  
    － リクエストパラメータ：{ "email": "ユーザーのメールアドレス" }  
    － レスポンス例：成功時 { "status": "success", "message": "メール送信完了" }、エラー時 { "status": "error", "errorCode": "ERR102", "errorMessage": "詳細なエラー内容" }  
- **DB連携**:  
  ・ ユーザー情報はユーザーDB（例：Firebase Firestore や MongoDB）より参照するが、本画面では直接参照は行わず、APIを通じた処理となる。  
- **参考資料・用語集**:  
  ・ 社内UIデザインガイドライン  
  ・ パスワードリセットフロー仕様書  
  ・ API仕様書（パスワードリセットAPIセクション）  

---

## 8. 課題、検討、不明事項

- API呼び出し時のレスポンス仕様が最終決定前のため、エラーレスポンスの詳細な項目や状況に応じたエラー表示方法を今後検討する必要がある。  
- 読み込み中インジケーターの表示タイミングおよび、連続クリックによる多重API呼び出しの防止策について追加検討が必要。  
- 画面遷移時のアニメーション効果や、成功メッセージ表示後の自動遷移仕様（例：一定秒後にログイン画面にリダイレクトするかどうか）の検討が未定。  
- エラーメッセージの文言や、国際化対応（多言語対応）の必要性について、プロダクト全体の設計と整合性を検討する必要がある。

---

## 9. 変更履歴

| 日付       | 変更内容                           | 担当者    |
| ---------- | ---------------------------------- | --------- |
| 2025-05-16 | 初版リリース                       | 廣澤     |